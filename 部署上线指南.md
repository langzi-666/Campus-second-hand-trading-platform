# 部署上线指南（前端）

本指南适用于本项目前端（Vite + Vue3）静态站点的上线。后端需独立部署，对外通过 `/api` 反向代理提供服务。

## 一、生产构建
- 进入前端目录并构建：
  - Windows PowerShell：
    - `cd frontend`
    - `npm ci`（首次）或 `npm install`
    - `npm run build`
  - 产物输出在 `frontend/dist/`
- 本地预览：
  - `npm run preview -- --port 5050`
  - 打开 http://localhost:5050

也可直接使用根目录的 `前端打包预览.bat` 一键完成。

---

## 二、Netlify 部署
1. 新建站点（From Git）或拖拽 `frontend/dist/` 到 Netlify Drop 直接部署。
2. 推荐 Git 方式：
   - Base directory: `frontend`
   - Build command: `npm run build`
   - Publish directory: `dist`
3. 环境变量：按需配置（如无后端域名变更可不设）。
4. SPA 路由：创建 `_redirects`（放在 `dist` 或 `public`）内容：
   - `/* /index.html 200`

---

## 三、Vercel 部署
1. Import Project → 选择仓库。
2. Project Settings：
   - Root Directory: `frontend`
   - Build Command: `npm run build`
   - Output Directory: `dist`
3. Vercel 默认支持 SPA 回退，无需额外配置（也可添加 `vercel.json` 强制回退）：
```json
{
  "rewrites": [{ "source": "/(.*)", "destination": "/index.html" }]
}
```
4. 如需代理后端，请在后端单独部署并开启 CORS，或在边缘函数实现 `/api` 代理。

---

## 四、Nginx 静态托管（推荐自建）
- 将 `frontend/dist/` 上传至服务器目录（例：`/var/www/campus-frontend`）。
- 典型 Nginx 配置（/etc/nginx/conf.d/campus-frontend.conf）：
```nginx
server {
  listen 80;
  server_name your-domain.com;

  root /var/www/campus-frontend;
  index index.html;

  # 前端静态资源
  location / {
    try_files $uri $uri/ /index.html;
  }

  # API 反向代理到后端（示例 http://localhost:8080）
  location /api/ {
    proxy_pass http://localhost:8080/api/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # 建议开启 gzip
  gzip on;
  gzip_types text/plain text/css application/json application/javascript application/xml+rss image/svg+xml;
}
```
- 重载 Nginx：`sudo nginx -t && sudo systemctl reload nginx`

---

## 五、Windows/IIS 简易部署（可选）
- 使用 IIS 静态站点指向 `frontend/dist/`，添加 URL Rewrite 规则：
  - `.*` → `/index.html`（条件：请求文件不存在时）
- 通过 ARR 将 `/api/` 反向代理到后端地址。

---

## 六、后端联通建议
- 前端目前开发使用 `/api` 前缀并在开发环境 `vite.config.js` 做了代理。
- 线上建议固定域名/子域名区分前后端，或由同域反代 `/api`。
- 若后端域名为 `https://api.your-domain.com`，则：
  - 可按需将 axios `baseURL` 调整为绝对路径，或在 Nginx 做 `/api` 反向代理。

---

## 七、常见问题
- 白屏或路由 404：确认已配置 SPA 回退（`try_files` 或 `_redirects`）。
- 接口跨域：前端若直连后端域名，请在后端开启 CORS（允许当前前端域名）。
- 预览端口冲突：更换 `npm run preview` 端口，比如 `--port 5050`。
- 静态资源路径：Vite 生产默认相对路径，通常无需额外 `base` 配置。
