# 校园二手交易平台技术架构文档 (毕业设计版)

## 1. 架构概览

### 1.1 整体架构
采用经典的三层架构模式，简单易懂，适合毕业设计项目。

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
├─────────────────────────────────────────────────────────────┤
│                    Web浏览器                                │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                      前端层                                  │
├─────────────────────────────────────────────────────────────┤
│              Vue.js + Element UI                            │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                      后端层                                  │
├─────────────────────────────────────────────────────────────┤
│              Spring Boot + MyBatis                         │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                     数据层                                   │
├─────────────────────────────────────────────────────────────┤
│                    MySQL 8.0                               │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 技术选型

#### 前端技术栈
- **框架**: Vue.js 3.x
- **UI组件库**: Element Plus
- **状态管理**: Vuex 4.x
- **路由管理**: Vue Router 4.x
- **HTTP客户端**: Axios
- **构建工具**: Vite
- **开发语言**: JavaScript

#### 后端技术栈
- **开发框架**: Spring Boot 2.7.x
- **数据访问**: MyBatis Plus
- **安全框架**: Spring Security + JWT
- **参数验证**: Hibernate Validator
- **API文档**: Swagger 3.x
- **开发语言**: Java 8/11

#### 数据库技术栈
- **关系数据库**: MySQL 8.0
- **连接池**: HikariCP (Spring Boot默认)
- **数据库迁移**: Flyway

#### 开发工具
- **IDE**: IntelliJ IDEA / VSCode
- **版本控制**: Git
- **项目管理**: Maven
- **接口测试**: Postman

## 2. 项目结构设计

### 2.1 前端项目结构
```
campus-trade-frontend/
├── public/                 # 静态资源
├── src/
│   ├── api/               # API接口
│   ├── assets/            # 资源文件
│   ├── components/        # 公共组件
│   ├── router/            # 路由配置
│   ├── store/             # 状态管理
│   ├── utils/             # 工具函数
│   ├── views/             # 页面组件
│   ├── App.vue            # 根组件
│   └── main.js            # 入口文件
├── package.json
└── vite.config.js
```

### 2.2 后端项目结构
```
campus-trade-backend/
├── src/main/java/com/campus/trade/
│   ├── config/            # 配置类
│   ├── controller/        # 控制器
│   ├── service/           # 业务逻辑
│   ├── mapper/            # 数据访问
│   ├── entity/            # 实体类
│   ├── dto/               # 数据传输对象
│   ├── utils/             # 工具类
│   ├── exception/         # 异常处理
│   └── CampusTradeApplication.java
├── src/main/resources/
│   ├── mapper/            # MyBatis映射文件
│   ├── application.yml    # 配置文件
│   └── db/migration/      # 数据库迁移脚本
└── pom.xml
```

## 3. 数据库设计

### 3.1 数据库结构
使用单数据库设计，简化部署和维护：

```sql
-- 数据库创建
CREATE DATABASE campus_trade DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3.2 核心表设计

#### 用户表 (users)
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    email VARCHAR(100) UNIQUE NOT NULL COMMENT '邮箱',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    nickname VARCHAR(50) NOT NULL COMMENT '昵称',
    avatar VARCHAR(500) COMMENT '头像URL',
    phone VARCHAR(20) COMMENT '手机号',
    student_id VARCHAR(20) COMMENT '学号',
    school VARCHAR(100) COMMENT '学校',
    college VARCHAR(100) COMMENT '学院',
    status TINYINT DEFAULT 1 COMMENT '状态：1正常，0禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB COMMENT='用户表';
```

#### 商品分类表 (categories)
```sql
CREATE TABLE categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '分类ID',
    name VARCHAR(50) NOT NULL COMMENT '分类名称',
    parent_id BIGINT DEFAULT 0 COMMENT '父分类ID',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用，0禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间'
) ENGINE=InnoDB COMMENT='商品分类表';
```

#### 商品表 (products)
```sql
CREATE TABLE products (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '商品ID',
    user_id BIGINT NOT NULL COMMENT '发布用户ID',
    category_id BIGINT NOT NULL COMMENT '分类ID',
    title VARCHAR(200) NOT NULL COMMENT '商品标题',
    description TEXT COMMENT '商品描述',
    price DECIMAL(10,2) NOT NULL COMMENT '价格',
    original_price DECIMAL(10,2) COMMENT '原价',
    images TEXT COMMENT '商品图片，JSON格式',
    condition_level TINYINT NOT NULL COMMENT '新旧程度：1全新，2几乎全新，3轻微使用，4明显使用，5重度使用',
    location VARCHAR(200) COMMENT '交易地点',
    status TINYINT DEFAULT 1 COMMENT '状态：1在售，2已售，3下架',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_user_id (user_id),
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
) ENGINE=InnoDB COMMENT='商品表';
```

#### 订单表 (orders)
```sql
CREATE TABLE orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '订单ID',
    order_no VARCHAR(32) UNIQUE NOT NULL COMMENT '订单号',
    buyer_id BIGINT NOT NULL COMMENT '买家ID',
    seller_id BIGINT NOT NULL COMMENT '卖家ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    price DECIMAL(10,2) NOT NULL COMMENT '交易价格',
    status TINYINT DEFAULT 1 COMMENT '状态：1待确认，2已确认，3已完成，4已取消',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_buyer_id (buyer_id),
    INDEX idx_seller_id (seller_id),
    INDEX idx_product_id (product_id),
    FOREIGN KEY (buyer_id) REFERENCES users(id),
    FOREIGN KEY (seller_id) REFERENCES users(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
) ENGINE=InnoDB COMMENT='订单表';
```

#### 消息表 (messages)
```sql
CREATE TABLE messages (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '消息ID',
    sender_id BIGINT NOT NULL COMMENT '发送者ID',
    receiver_id BIGINT NOT NULL COMMENT '接收者ID',
    product_id BIGINT COMMENT '关联商品ID',
    content TEXT NOT NULL COMMENT '消息内容',
    type TINYINT DEFAULT 1 COMMENT '消息类型：1文本，2图片',
    is_read TINYINT DEFAULT 0 COMMENT '是否已读：0未读，1已读',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    
    INDEX idx_sender_id (sender_id),
    INDEX idx_receiver_id (receiver_id),
    INDEX idx_product_id (product_id),
    FOREIGN KEY (sender_id) REFERENCES users(id),
    FOREIGN KEY (receiver_id) REFERENCES users(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
) ENGINE=InnoDB COMMENT='消息表';
```

## 4. API设计规范

### 4.1 RESTful API规范
```
GET    /api/users          # 获取用户列表
GET    /api/users/{id}     # 获取用户详情
POST   /api/users          # 创建用户
PUT    /api/users/{id}     # 更新用户
DELETE /api/users/{id}     # 删除用户
```

### 4.2 统一响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2024-11-14T22:00:00"
}
```

### 4.3 错误码定义
- **200**: 成功
- **400**: 参数错误
- **401**: 未授权
- **403**: 禁止访问
- **404**: 资源不存在
- **500**: 服务器错误

## 5. 安全设计

### 5.1 身份认证
- **JWT Token**: 用户登录后生成JWT令牌
- **Token过期**: 设置合理的过期时间（如7天）
- **密码加密**: 使用BCrypt加密用户密码

### 5.2 数据验证
- **前端验证**: 表单数据基础验证
- **后端验证**: 使用Hibernate Validator进行参数校验
- **SQL注入防护**: 使用MyBatis预编译语句

### 5.3 文件上传安全
- **文件类型限制**: 只允许图片格式
- **文件大小限制**: 单个文件不超过5MB
- **文件名处理**: 重命名上传文件避免冲突

## 6. 部署方案

### 6.1 开发环境
```yaml
# 本地开发环境配置
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/campus_trade
    username: root
    password: password
  
server:
  port: 8080
```

### 6.2 生产环境
- **服务器**: 云服务器（阿里云/腾讯云）
- **数据库**: 云数据库MySQL
- **文件存储**: 云存储服务
- **域名**: 申请域名并备案

### 6.3 部署步骤
1. **后端部署**:
   ```bash
   # 打包Spring Boot应用
   mvn clean package
   
   # 运行jar包
   java -jar campus-trade-backend.jar
   ```

2. **前端部署**:
   ```bash
   # 构建前端项目
   npm run build
   
   # 部署到Web服务器（Nginx）
   cp -r dist/* /var/www/html/
   ```

## 7. 开发规范

### 7.1 代码规范
- **Java**: 遵循阿里巴巴Java开发手册
- **JavaScript**: 使用ESLint进行代码检查
- **数据库**: 表名、字段名使用下划线命名
- **API**: 使用RESTful风格

### 7.2 Git规范
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
```

### 7.3 测试规范
- **单元测试**: 使用JUnit进行后端测试
- **接口测试**: 使用Postman测试API
- **功能测试**: 手动测试核心功能

## 8. 项目特色

### 8.1 技术亮点
- **前后端分离**: 清晰的架构分层
- **响应式设计**: 适配不同屏幕尺寸
- **实时消息**: 基于轮询的消息系统
- **文件上传**: 支持图片上传和展示

### 8.2 业务亮点
- **校园认证**: 基于学号的用户认证
- **分类管理**: 灵活的商品分类体系
- **交易流程**: 简化的交易确认流程
- **消息沟通**: 买卖双方在线沟通

---

**文档版本**: v1.0 (毕业设计版)  
**创建日期**: 2024年11月14日  
**适用场景**: 大学生毕业设计项目
